from batchio import *
from extras import *
from features import *
import numpy as np
from sklearn.cross_validation import cross_val_score
from sklearn.linear_model import LinearRegression,\
    LogisticRegression,SGDRegressor,Perceptron
from sklearn.tree import DecisionTreeRegressor,\
    ExtraTreeRegressor
from sklearn.svm import LinearSVC,SVC
from sklearn.ensemble import RandomForestRegressor,\
                            BaggingRegressor
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import mean_absolute_error
from sklearn.base import clone
import warnings
import sys

def clf_generator():
    clfs = [
        RandomForestRegressor(n_estimators=2000,verbose=1,n_jobs=1),
        # BaggingRegressor(base_estimator=LinearRegression(),n_estimators=5000),
        # LinearRegression(),
    ]
    for clf in clfs:
        yield clf,clone(clf)

def main():
    params = load_params()
    train_df,test_df = data_parse(params)
    X,yw,yb = process_features(train_df,"train",params)
    #Scale up X
    for clf_w,clf_b in clf_generator():
        print list(X.columns.values)
        print clf_w
        # print cross_val_score(estimator=clf_w,
        #                       scoring="mean_absolute_error",
        #                       cv=4,
        #                       X=X,
        #                       y=yw,
        #                       n_jobs=1)
        # print cross_val_score(estimator=clf_b,
        #                       scoring="mean_absolute_error",
        #                       cv=4,
        #                       X=X,
        #                       y=yb,
        #                       n_jobs=1)
        print "\n"
        print "Training ..."
        clf_w.fit(X,yw)
        clf_b.fit(X,yb)
        print "Testing ..."
        X = process_features(test_df,"test",params)
        #print test_df.head()
        yw = clf_w.predict(X)
        yb = clf_b.predict(X)
        create_submission(test_df["Event"],yw,yb)

if __name__ == '__main__':
    warnings.filterwarnings("ignore")
    #sys.stdout = open("logs.txt","a")
    main()

